<html>

<head>
    <script src="js/jquery.min.js"></script>
    <script src="js/skel.min.js"></script>
    <script src="js/util.js"></script>
    <title>Dự thi King & Queen - Predestination Prom 2018</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<meta property="og:image" content="fb1.jpg" />
	<meta property="og:content" content="Đăng ký ngay!" />
    <link rel="stylesheet" href="js/style.css">
    <script src="/ga.js"></script>
    <script src='https://www.google.com/recaptcha/api.js'></script>
    <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
</head>

<body class="">
    <div id="wrapper">
        <header id="header" style="display: flex;">
            <div class="logo"><span class="icon fa-diamond"></span></div>
            <div class="content">
                <div class="inner">
					<h4>Predestination Prom 2018</h4>
                    <h1>KING & QUEEN</h1>
                    <p>Trong không gian đầy sức huyền ảo và mê hoặc của Masquerade Prom, King và Queen sẽ được đội vương miện đầy quyền uy và trở thành trung tâm của tất cả những lữ khách đeo mặt nạ xung quanh. Một không gian tuyệt vời và lãng mạn tưởng như chỉ có trong thơ ca như vậy, bạn đã sẵn sàng để trải nghiệm?</p>
                </div>
            </div>
            <nav class="use-middle">
                <ul>
                    <li><a href="#contact">Đăng ký ngay</a></li>
                </ul>
            </nav>
        </header>
        <div id="main" style="display: none;">
			<article id="contact" style="display: none;" class="">
                <h2 class="major">King & Queen</h2>
                <form method="post" action="#" id="myform">
                    <div class="field half first">
						<label for="name">Họ và tên của bạn</label><input type="text" name="name" id="quest1a">
					</div>
                    <div class="field half">
						<label for="dob">Ngày/tháng/năm sinh</label><input type="text" name="dob" id="quest2a" placeholder="dd/mm/yyyy">
					</div>
					<div class="field half first">
						<label for="cla">Lớp - khóa</label><input type="text" name="cla" id="quest3a" placeholder="">
					</div>
					<div class="field half">
						<label for="phone">Số điện thoại</label><input type="text" name="phone" id="quest4a" placeholder="">
					</div>
                    <div class="field half first">
						<label for="fb">Link facebook</label><input type="text" name="fb" id="quest5a" placeholder="">
                    </div>
                    <div class="field half">
                        <label for="name">Bạn muốn đăng ký làm...</label>
                        <select id="quest6a">
                            <option value="">...</option>
                            <option value="King">King</option>
                            <option value="Queen">Queen</option>
                        </select>
                    </div>
					<div class="field">
						<label for="email">Email của bạn</label><input type="text" name="email" id="quest7a" placeholder="">
						<p>Chúng mình sẽ gửi 1 email xác nhận cho bạn sau khi đơn này được ghi nhận.</p>
					</div>
					
                    <div class="field"><label for="message">Giới thiệu ấn tượng nhất về bản thân của bạn:</label><textarea name="message" id="quest2" rows="5"></textarea></div>
                    <p><b>Lưu ý:</b> Bài viết ít nhất 150 từ. Hiện tại bạn đã viết <span id="wcount">0</span> từ.
                    <br/>Sau khi được chọn, bài viết này sẽ đăng trên page của Predestination Prom 2018 cùng với ảnh dự thi của bạn.</p>
					<!--div class="field"><label for="message">Bạn nghĩ mình sẽ làm gì để chiến thắng và trở thành King/Queen:</label><textarea name="message" id="quest8" rows="5"></textarea></div-->
					<div class="field"><label for="message">Hãy dẫn link bức ảnh chân dung đẹp nhất của bạn:</label><textarea name="message" id="quest3" rows="2"></textarea>
					<p><b>Lưu ý:</b> Hãy cân nhắc lựa chọn và gửi ảnh về cho BTC Predestination Prom 2018 vì bức ảnh này sẽ đại diện cho bạn trong suốt quá trình tham gia cuộc thi.</p>
					<div class="field"><label for="message">Bạn còn câu hỏi nào cho BTC không?</label><textarea name="message" id="quest4" rows="2" placeholder="(không bắt buộc)"></textarea>
					</div>
					<br/>
					<b id="not_filled" style="display:none"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> LỖI: BẠN CHƯA ĐIỀN HẾT CÁC PHẦN CẦN ĐIỀN<br/><br/></b>
                    <ul class="actions">
                        <!--li><button type="button" onclick="sendNui()" class="special" id="send_nui">Gửi đăng ký</button></li-->
                        <li></li><button
                            type="button"
							class="g-recaptcha special"
							data-sitekey="6LfGPU0UAAAAABgLpndgnrXfQ-K1teUpWQl8vlh9"
							data-callback="sendNui"
							id="send_nui">
							Gửi đăng ký
						</button></li>
						<li><b id="sending" style="display:none"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>Đang gửi...</b></li>
                        <!--li><input type="reset" value="Reset"></li-->
                    </ul>
                </form>
                <!--ul class="icons">
                    <li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
                    <li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
                    <li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
                    <li><a href="#" class="icon fa-github"><span class="label">GitHub</span></a></li>
                </ul-->
                <div class="close">Close</div>
            </article>
            <article id="done" style="display: none;" class="">
                <h2 class="major">Thành công!</h2>
                <p>Bạn đã gửi bản đăng ký. Một email xác nhận đã được gửi tới email do bạn cung cấp.<br/>
				Xin cảm ơn bạn!</p>
                <div class="close">Close</div>
            </article>
		</div>
        <footer id="footer" style="display: block;">
            <p class="copyright">Designed by Nui Nui</p>
        </footer>
    </div>
    <div id="bg"></div>
    <script src="cookie.js"></script>
    <script>
		function sendNui(token) {
			var q1a= $('#quest1a').val();
			var q2a= $('#quest2a').val();
			var q3a= $('#quest3a').val();
			var q4a= $('#quest4a').val();
			var q5a= $('#quest5a').val();
			var q6a= $('#quest6a').val();
			var q7a= $('#quest7a').val();
			var q2 = $('#quest2' ).val();
			var q3 = $('#quest3' ).val();
			var q4 = $('#quest4' ).val();
			
			if (
				isEmpty(q1a) ||
				isEmpty(q2a) ||
				isEmpty(q3a) ||
				isEmpty(q4a) ||
				isEmpty(q5a) ||
				isEmpty(q6a) ||
				isEmpty(q7a) ||
				isEmpty(q2 ) ||
				isEmpty(q3 )
			) {
				$('#not_filled').show();
                setTimeout(function() {$('#not_filled').hide();}, 6000);
                grecaptcha.reset();
			} else if (countWords(q2) < 150) {
                alert('Lỗi: Phần giới thiệu bản thân phải ít nhất là 150 từ bạn nhé!');
                grecaptcha.reset();
			} else {
				$('#not_filled').hide();
				$('#sending').show();
				$('#send_nui').hide();
				var data = {
                    "g-recaptcha-response": grecaptcha.getResponse(),
					"name" : q1a,
					"email" : q7a,
					"type" : q6a,
                    "data" : "Tên: " + q1a + " \n"
                        +"DOB " + q2a + " \n"
						+"Lớp: " + q3a + " \n"
						+"Link fb: " + q4a + " \n"
						+"SĐT: " + q5a + " \n"
						+"ĐK làm: " + q6a + " \n"
						+"Email: " + q7a + " \n"
						+"• Giới thiệu về bản thân: " + q2 + " \n"
						+"• Link ảnh: " + q3 + " \n"
						+"• Câu hỏi cho BTC: " + q4
				};
				$.ajax({
					url: "https://api.chatbot.ngxson.com/prom18/knq",
					data: data,
					type: "POST",
					timeout: 15000,
					success: function (data) {
						if(data == 'OK') {
							window.location.href = "#done";
							document.getElementById("myform").reset();
							$('#send_nui').show();
                            $('#sending').hide();
                            grecaptcha.reset();
                            setCookie("q2", "", 0);
						} else {
							alert("Có lỗi xảy ra, xin hãy thử lại \n");
							$('#send_nui').show();
                            $('#sending').hide();
                            grecaptcha.reset();
						}
					},
					error: function (xhr, ajaxOptions, thrownError) {
						alert("Có lỗi xảy ra, xin hãy thử lại \n"+thrownError);
						$('#send_nui').show();
                        $('#sending').hide();
                        grecaptcha.reset();
					}
				});
				//console.log(data);
			}
		}
		function countWords(str) {
			return str.trim().split(/\s+/).length;
		}
		function isEmpty(obj) {
			return (obj == null || obj == "" || obj == undefined);
		}
        (function($) {
            var old_q2 = getCookie("q2");
            if (old_q2) {
                $('#quest2').val(old_q2);
                $("#wcount").html(countWords(old_q2));
            }
            $('#quest2').bind('input change paste keyup mouseup',function(e) {
                var current_q2 = $('#quest2').val();
                $("#wcount").html(countWords(current_q2));
                if (e.keyCode == 0 || e.keyCode == 32 || e.keyCode == 8 || e.keyCode == 46) {
                    setCookie("q2", current_q2, 10080);
                    console.log("auto saved")
                }
            });
            skel.breakpoints({
                xlarge: '(max-width: 1680px)',
                large: '(max-width: 1280px)',
                medium: '(max-width: 980px)',
                small: '(max-width: 736px)',
                xsmall: '(max-width: 480px)',
                xxsmall: '(max-width: 360px)'
            });
            $(function() {
                var $window = $(window),
                    $body = $('body'),
                    $wrapper = $('#wrapper'),
                    $header = $('#header'),
                    $footer = $('#footer'),
                    $main = $('#main'),
                    $main_articles = $main.children('article');
                $body.addClass('is-loading');
                $window.on('load', function() {
                    window.setTimeout(function() {
                        $body.removeClass('is-loading');
                    }, 100);
                });
                $('form').placeholder();
                if (skel.vars.IEVersion < 12) {
                    var flexboxFixTimeoutId;
                    $window.on('resize.flexbox-fix', function() {
                        clearTimeout(flexboxFixTimeoutId);
                        flexboxFixTimeoutId = setTimeout(function() {
                            if ($wrapper.prop('scrollHeight') > $window.height()) $wrapper.css('height', 'auto');
                            else $wrapper.css('height', '100vh');
                        }, 250);
                    }).triggerHandler('resize.flexbox-fix');
                }
                var $nav = $header.children('nav'),
                    $nav_li = $nav.find('li');
                if ($nav_li.length % 2 == 0) {
                    $nav.addClass('use-middle');
                    $nav_li.eq(($nav_li.length / 2)).addClass('is-middle');
                }
                var delay = 325,
                    locked = false;
                $main._show = function(id, initial) {
                    var $article = $main_articles.filter('#' + id);
                    if ($article.length == 0) return;
                    if (locked || (typeof initial != 'undefined' && initial === true)) {
                        $body.addClass('is-switching');
                        $body.addClass('is-article-visible');
                        $main_articles.removeClass('active');
                        $header.hide();
                        $footer.hide();
                        $main.show();
                        $article.show();
                        $article.addClass('active');
                        locked = false;
                        setTimeout(function() {
                            $body.removeClass('is-switching');
                        }, (initial ? 1000 : 0));
                        return;
                    }
                    locked = true;
                    if ($body.hasClass('is-article-visible')) {
                        var $currentArticle = $main_articles.filter('.active');
                        $currentArticle.removeClass('active');
                        setTimeout(function() {
                            $currentArticle.hide();
                            $article.show();
                            setTimeout(function() {
                                $article.addClass('active');
                                $window.scrollTop(0).triggerHandler('resize.flexbox-fix');
                                setTimeout(function() {
                                    locked = false;
                                }, delay);
                            }, 25);
                        }, delay);
                    } else {
                        $body.addClass('is-article-visible');
                        setTimeout(function() {
                            $header.hide();
                            $footer.hide();
                            $main.show();
                            $article.show();
                            setTimeout(function() {
                                $article.addClass('active');
                                $window.scrollTop(0).triggerHandler('resize.flexbox-fix');
                                setTimeout(function() {
                                    locked = false;
                                }, delay);
                            }, 25);
                        }, delay);
                    }
                };
                $main._hide = function(addState) {
                    var $article = $main_articles.filter('.active');
                    if (!$body.hasClass('is-article-visible')) return;
                    if (typeof addState != 'undefined' && addState === true) history.pushState(null, null, '#');
                    if (locked) {
                        $body.addClass('is-switching');
                        $article.removeClass('active');
                        $article.hide();
                        $main.hide();
                        $footer.show();
                        $header.show();
                        $body.removeClass('is-article-visible');
                        locked = false;
                        $body.removeClass('is-switching');
                        $window.scrollTop(0).triggerHandler('resize.flexbox-fix');
                        return;
                    }
                    locked = true;
                    $article.removeClass('active');
                    setTimeout(function() {
                        $article.hide();
                        $main.hide();
                        $footer.show();
                        $header.show();
                        setTimeout(function() {
                            $body.removeClass('is-article-visible');
                            $window.scrollTop(0).triggerHandler('resize.flexbox-fix');
                            setTimeout(function() {
                                locked = false;
                            }, delay);
                        }, 25);
                    }, delay);
                };
                $main_articles.each(function() {
                    var $this = $(this);
                    $('<div class="close">Close</div>').appendTo($this).on('click', function() {
                        location.hash = '';
                    });
                    $this.on('click', function(event) {
                        event.stopPropagation();
                    });
                });
                $body.on('click', function(event) {
                    if ($body.hasClass('is-article-visible')) $main._hide(true);
                });
                $window.on('keyup', function(event) {
                    switch (event.keyCode) {
                        case 27:
                            if ($body.hasClass('is-article-visible')) $main._hide(true);
                            break;
                        default:
                            break;
                    }
                });
                $window.on('hashchange', function(event) {
                    if (location.hash == '' || location.hash == '#') {
                        event.preventDefault();
                        event.stopPropagation();
                        $main._hide();
                    } else if ($main_articles.filter(location.hash).length > 0) {
                        event.preventDefault();
                        event.stopPropagation();
                        $main._show(location.hash.substr(1));
                    }
                });
                if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
                else {
                    var oldScrollPos = 0,
                        scrollPos = 0,
                        $htmlbody = $('html,body');
                    $window.on('scroll', function() {
                        oldScrollPos = scrollPos;
                        scrollPos = $htmlbody.scrollTop();
                    }).on('hashchange', function() {
                        $window.scrollTop(oldScrollPos);
                    });
                }
                $main.hide();
                $main_articles.hide();
                if (location.hash != '' && location.hash != '#') $window.on('load', function() {
                    $main._show(location.hash.substr(1), true);
                });
            });
        })(jQuery);
    </script>
</body>

</html>
